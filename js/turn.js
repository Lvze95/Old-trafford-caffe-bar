!function($){"use strict";var f,g,h="",b=Math.PI,i=b/2,a="ontouchstart"in window,c=a?{down:"touchstart",move:"touchmove",up:"touchend",over:"touchstart",out:"touchend"}:{down:"mousedown",move:"mousemove",up:"mouseup",over:"mouseover",out:"mouseout"},j={backward:["bl","tl"],forward:["br","tr"],all:["tl","bl","tr","br","l","r"]},k=["single","double"],l=["ltr","rtl"],m={acceleration:!0,display:"double",duration:600,page:1,gradients:!0,turnCorners:"bl,br",when:null},n={cornerSize:100},o={init:function(b){f="WebKitCSSMatrix"in window||"MozPerspective"in document.body.style,g=v(),h=d();var i,k=0,e=this.data(),j=this.children();if(b=$.extend({width:this.width(),height:this.height(),direction:this.attr("dir")||this.css("direction")||"ltr"},m,b),e.opts=b,e.pageObjs={},e.pages={},e.pageWrap={},e.pageZoom={},e.pagePlace={},e.pageMv=[],e.zoom=1,e.totalPages=b.pages||0,e.eventHandlers={touchStart:$.proxy(o._touchStart,this),touchMove:$.proxy(o._touchMove,this),touchEnd:$.proxy(o._touchEnd,this),start:$.proxy(o._eventStart,this)},b.when)for(i in b.when)y(i,b.when)&&this.bind(i,b.when[i]);for(this.css({position:"relative",width:b.width,height:b.height}),this.turn("display",b.display),""!==b.direction&&this.turn("direction",b.direction),f&&!a&&b.acceleration&&this.transform(w(0,0,!0)),i=0;i<j.length;i++)"1"!=$(j[i]).attr("ignore")&&this.turn("addPage",j[i],++k);return $(this).bind(c.down,e.eventHandlers.touchStart).bind("end",o._eventEnd).bind("pressed",o._eventPressed).bind("released",o._eventReleased).bind("flip",o._flip),$(this).parent().bind("start",e.eventHandlers.start),$(document).bind(c.move,e.eventHandlers.touchMove).bind(c.up,e.eventHandlers.touchEnd),this.turn("page",b.page),e.done=!0,this},addPage:function(e,a){var f,g,d=!1,b=this.data(),c=b.totalPages+1;if(b.destroying)return!1;if((f=/\bp([0-9]+)\b/.exec($(e).attr("class")))&&(a=parseInt(f[1],10)),a){if(a==c)d=!0;else if(a>c)throw B('Page "'+a+'" cannot be inserted')}else a=c,d=!0;return a>=1&&a<=c&&(g="double"==b.display?a%2?" odd":" even":"",b.done&&this.turn("stop"),a in b.pageObjs&&o._movePages.call(this,a,1),d&&(b.totalPages=c),b.pageObjs[a]=$(e).css({float:"left"}).addClass("page p"+a+g),!C()&&b.pageObjs[a].hasClass("hard")&&b.pageObjs[a].removeClass("hard"),o._addPage.call(this,a),o._removeFromDOM.call(this)),this},_addPage:function(a){var b=this.data(),c=b.pageObjs[a];if(c){if(o._necessPage.call(this,a)){if(!b.pageWrap[a]){b.pageWrap[a]=$("<div/>",{class:"page-wrapper",page:a,css:{position:"absolute",overflow:"hidden"}}),this.append(b.pageWrap[a]),b.pagePlace[a]||(b.pagePlace[a]=a,b.pageObjs[a].appendTo(b.pageWrap[a]));var d=o._pageSize.call(this,a,!0);c.css({width:"100%",height:d.height}),b.pageWrap[a].css(d)}b.pagePlace[a]==a&&o._makeFlip.call(this,a)}else b.pagePlace[a]=0,b.pageObjs[a]&&b.pageObjs[a].remove()}},hasPage:function(a){return y(a,this.data().pageObjs)},center:function(e){var a=this.data(),b=$(this).turn("size"),c=0;if(!a.noCenter&&"double"==a.display){var d=this.turn("view",e||a.tpage||a.page);"ltr"==a.direction?d[0]?d[1]||(c+=b.width/4):c-=b.width/4:d[0]?d[1]||(c-=b.width/4):c+=b.width/4}return this},destroy:function(){var b=this,a=this.data();if("prevented"!=A("destroying",this)){for(a.destroying=!0,$.each(["end","first","flip","last","pressed","released","start","turning","turned","zooming","missing",],function(c,a){b.unbind(a)}),this.parent().unbind("start",a.eventHandlers.start),$(document).unbind(c.move,a.eventHandlers.touchMove).unbind(c.up,a.eventHandlers.touchEnd);0!==a.totalPages;)this.turn("removePage",a.totalPages);return a.fparent&&a.fparent.remove(),a.shadow&&a.shadow.remove(),this.removeData(),a=null,this}},is:function(){return"object"==typeof this.data().pages},zoom:function(b){var a=this.data();if("number"!=typeof b)return a.zoom;if(b<.001||b>100)throw B(b+" is not a value for zoom");if("prevented"==A("zooming",this,[b,a.zoom]))return this;var e=this.turn("size"),c=this.turn("view"),f=1/a.zoom,g=Math.round(e.width*f*b),h=Math.round(e.height*f*b);a.zoom=b,$(this).turn("stop").turn("size",g,h),a.opts.autoCenter&&this.turn("center"),o._updateShadow.call(this);for(var d=0;d<c.length;d++)c[d]&&a.pageZoom[c[d]]!=a.zoom&&(this.trigger("zoomed",[c[d],c,a.pageZoom[c[d]],a.zoom,]),a.pageZoom[c[d]]=a.zoom);return this},_pageSize:function(c,f){var b=this.data(),a={};if("single"==b.display)a.width=this.width(),a.height=this.height(),f&&(a.top=0,a.left=0,a.right="auto");else{var e=this.width()/2,g=this.height();if(b.pageObjs[c].hasClass("own-size")?(a.width=b.pageObjs[c].width(),a.height=b.pageObjs[c].height()):(a.width=e,a.height=g),f){var d=c%2;a.top=(g-a.height)/2,"ltr"==b.direction?(a[d?"right":"left"]=e-a.width,a[d?"left":"right"]="auto"):(a[d?"left":"right"]=e-a.width,a[d?"right":"left"]="auto")}}return a},_makeFlip:function(a){var b=this.data();if(!b.pages[a]&&b.pagePlace[a]==a){var c="single"==b.display,d=a%2;b.pages[a]=b.pageObjs[a].css(o._pageSize.call(this,a)).flip({page:a,next:d||c?a+1:a-1,turn:this}).flip("disable",b.disabled),o._setPageLoc.call(this,a),b.pageZoom[a]=b.zoom}return b.pages[a]},_makeRange:function(){var a,b;if(!(this.data().totalPages<1))for(a=(b=this.turn("range"))[0];a<=b[1];a++)o._addPage.call(this,a)},range:function(c){var d,e,f,a,b=this.data();if(c=c||b.tpage||b.page||1,a=o._view.call(this,c),c<1||c>b.totalPages)throw B('"'+c+'" is not a valid page');return a[1]=a[1]||a[0],a[0]>=1&&a[1]<=b.totalPages?(d=Math.floor(2),b.totalPages-a[1]>a[0]?(e=Math.min(a[0]-1,d),f=2*d-e):(f=Math.min(b.totalPages-a[1],d),e=2*d-f)):(e=5,f=5),[Math.max(1,a[0]-e),Math.min(b.totalPages,a[1]+f),]},_necessPage:function(a){if(0===a)return!0;var b=this.turn("range");return this.data().pageObjs[a].hasClass("fixed")||a>=b[0]&&a<=b[1]},_removeFromDOM:function(){var a,b=this.data();for(a in b.pageWrap)y(a,b.pageWrap)&&!o._necessPage.call(this,a)&&o._removePageFromDOM.call(this,a)},_removePageFromDOM:function(a){var b=this.data();if(b.pages[a]){var c=b.pages[a].data();p._moveFoldingPage.call(b.pages[a],!1),c.f&&c.f.fwrapper&&c.f.fwrapper.remove(),b.pages[a].removeData(),b.pages[a].remove(),delete b.pages[a]}b.pageObjs[a]&&b.pageObjs[a].remove(),b.pageWrap[a]&&(b.pageWrap[a].remove(),delete b.pageWrap[a]),o._removeMv.call(this,a),delete b.pagePlace[a],delete b.pageZoom[a]},removePage:function(b){var a=this.data();if("*"==b)for(;0!==a.totalPages;)this.turn("removePage",a.totalPages);else{if(b<1||b>a.totalPages)throw B("The page "+b+" doesn't exist");a.pageObjs[b]&&(this.turn("stop"),o._removePageFromDOM.call(this,b),delete a.pageObjs[b]),o._movePages.call(this,b,-1),a.totalPages=a.totalPages-1,a.page>a.totalPages?(a.page=null,o._fitPage.call(this,a.totalPages)):(o._makeRange.call(this),this.turn("update"))}return this},_movePages:function(c,e){var a,f=this,b=this.data(),g="single"==b.display,d=function(a){var c=a+e,d=c%2;b.pageObjs[a]&&(b.pageObjs[c]=b.pageObjs[a].removeClass("p"+a+" odd even").addClass("p"+c+(d?" odd ":" even "))),b.pagePlace[a]&&b.pageWrap[a]&&(b.pagePlace[c]=c,b.pageObjs[c].hasClass("fixed")?b.pageWrap[c]=b.pageWrap[a].attr("page",c):b.pageWrap[c]=b.pageWrap[a].css(o._pageSize.call(f,c,!0)).attr("page",c),b.pages[a]&&(b.pages[c]=b.pages[a].flip("options",{page:c,next:g||d?c+1:c-1})),e&&(delete b.pages[a],delete b.pagePlace[a],delete b.pageZoom[a],delete b.pageObjs[a],delete b.pageWrap[a]))};if(e>0)for(a=b.totalPages;a>=c;a--)d(a);else for(a=c;a<=b.totalPages;a++)d(a)},display:function(b){var a=this.data(),c=a.display;if(void 0===b)return c;if(-1==$.inArray(b,k))throw B('"'+b+'" is not a value for display');switch(b){case"single":a.pageObjs[0]||(this.turn("stop").css({overflow:"hidden"}),a.pageObjs[0]=$("<div />",{class:"page p-temporal"}).css({width:this.width(),height:this.height()}).appendTo(this)),this.addClass("shadow");break;case"double":a.pageObjs[0]&&(this.turn("stop").css({overflow:""}),a.pageObjs[0].remove(),delete a.pageObjs[0]),this.removeClass("shadow")}if(a.display=b,c){var d=this.turn("size");o._movePages.call(this,1,0),this.turn("size",d.width,d.height).turn("update")}return this},direction:function(a){var b=this.data();if(void 0===a)return b.direction;if(a=a.toLowerCase(),-1==$.inArray(a,l))throw B('"'+a+'" is not a value for direction');return"rtl"==a&&$(this).attr("dir","ltr").css({direction:"ltr"}),b.direction=a,b.done&&this.turn("size",$(this).width(),$(this).height()),this},animating:function(){return this.data().pageMv.length>0},corner:function(){var c,a,b=this.data();for(a in b.pages)if(y(a,b.pages)&&(c=b.pages[a].flip("corner")))return c;return!1},data:function(){return this.data()},disable:function(c){var b,a=this.data(),d=this.turn("view");for(b in a.disabled=void 0===c|| !0===c,a.pages)y(b,a.pages)&&a.pages[b].flip("disable",!!a.disabled|| -1==$.inArray(parseInt(b,10),d));return this},disabled:function(a){return void 0===a?!0===this.data().disabled:this.turn("disable",a)},size:function(d,e){if(void 0===d|| void 0===e)return{width:this.width(),height:this.height()};this.turn("stop");var b,c,a=this.data(),f="double"==a.display?d/2:d;for(b in this.css({width:d,height:e}),a.pageObjs[0]&&a.pageObjs[0].css({width:f,height:e}),a.pageWrap)y(b,a.pageWrap)&&(c=o._pageSize.call(this,b,!0),a.pageObjs[b].css({width:c.width,height:c.height}),a.pageWrap[b].css(c),a.pages[b]&&a.pages[b].css({width:c.width,height:c.height}));return this.turn("resize"),this},resize:function(){var b,a=this.data();for(a.pages[0]&&(a.pageWrap[0].css({left:-this.width()}),a.pages[0].flip("resize",!0)),b=1;b<=a.totalPages;b++)a.pages[b]&&a.pages[b].flip("resize",!0);o._updateShadow.call(this),a.opts.autoCenter&&this.turn("center")},_removeMv:function(c){var a,b=this.data();for(a=0;a<b.pageMv.length;a++)if(b.pageMv[a]==c)return b.pageMv.splice(a,1),!0;return!1},_addMv:function(a){var b=this.data();o._removeMv.call(this,a),b.pageMv.push(a)},_view:function(a){var b=this.data();return(a=a||b.page,"double"==b.display)?a%2?[a-1,a]:[a,a+1]:[a]},view:function(c){var b=this.data(),a=o._view.call(this,c);return"double"==b.display?[a[0]>0?a[0]:0,a[1]<=b.totalPages?a[1]:0,]:[a[0]>0&&a[0]<=b.totalPages?a[0]:0]},stop:function(f,e){if(this.turn("animating")){var c,b,d,a=this.data();for(a.tpage&&(a.page=a.tpage,delete a.tpage),c=0;c<a.pageMv.length;c++)a.pageMv[c]&&a.pageMv[c]!==f&&(b=(d=a.pages[a.pageMv[c]]).data().f.opts,d.flip("hideFoldedPage",e),e||p._moveFoldingPage.call(d,!1),b.force&&(b.next=b.page%2==0?b.page-1:b.page+1,delete b.force))}return this.turn("update"),this},pages:function(b){var a=this.data();if(!b)return a.totalPages;if(b<a.totalPages)for(var c=a.totalPages;c>b;c--)this.turn("removePage",c);return a.totalPages=b,o._fitPage.call(this,a.page),this},_missing:function(e){var c=this.data();if(!(c.totalPages<1)){var a,d=this.turn("range",e),b=[];for(a=d[0];a<=d[1];a++)c.pageObjs[a]||b.push(a);b.length>0&&this.trigger("missing",[b])}},_fitPage:function(d){var a=this.data(),b=this.turn("view",d);if(o._missing.call(this,d),a.pageObjs[d]){a.page=d,this.turn("stop");for(var c=0;c<b.length;c++)b[c]&&a.pageZoom[b[c]]!=a.zoom&&(this.trigger("zoomed",[b[c],b,a.pageZoom[b[c]],a.zoom,]),a.pageZoom[b[c]]=a.zoom);o._removeFromDOM.call(this),o._makeRange.call(this),o._updateShadow.call(this),this.trigger("turned",[d,b]),this.turn("update"),a.opts.autoCenter&&this.turn("center")}},_turnPage:function(b){var c,e,a=this.data(),i=a.pagePlace[b],d=this.turn("view"),f=this.turn("view",b);if(a.page!=b){var k=a.page;if("prevented"==A("turning",this,[b,f])){k==a.page&& -1!=$.inArray(i,a.pageMv)&&a.pages[i].flip("hideFoldedPage",!0);return}-1!=$.inArray(1,f)&&this.trigger("first"),-1!=$.inArray(a.totalPages,f)&&this.trigger("last")}"single"==a.display?(c=d[0],e=f[0]):d[1]&&b>d[1]?(c=d[1],e=f[0]):d[0]&&b<d[0]&&(c=d[0],e=f[1]);var j=a.opts.turnCorners.split(","),g=a.pages[c].data().f,h=g.opts,l=g.point;o._missing.call(this,b),a.pageObjs[b]&&(this.turn("stop"),a.page=b,o._makeRange.call(this),a.tpage=e,h.next!=e&&(h.next=e,h.force=!0),this.turn("update"),g.point=l,"hard"==g.effect?"ltr"==a.direction?a.pages[c].flip("turnPage",b>c?"r":"l"):a.pages[c].flip("turnPage",b>c?"l":"r"):"ltr"==a.direction?a.pages[c].flip("turnPage",j[b>c?1:0]):a.pages[c].flip("turnPage",j[b>c?0:1]))},page:function(a){var b=this.data();if(void 0===a)return b.page;if(!b.disabled&&!b.destroying){if((a=parseInt(a,10))>0&&a<=b.totalPages)return a!=b.page&&(b.done&& -1==$.inArray(a,this.turn("view"))?o._turnPage.call(this,a):o._fitPage.call(this,a)),this;throw B("The page "+a+" does not exist")}},next:function(){return this.turn("page",Math.min(this.data().totalPages,o._view.call(this,this.data().page).pop()+1))},previous:function(){return this.turn("page",Math.max(1,o._view.call(this,this.data().page).shift()-1))},peel:function(c,a){var e,b=this.data(),d=this.turn("view");return a=void 0===a|| !0===a,!1===c?this.turn("stop",null,a):"single"==b.display?b.pages[b.page].flip("peel",c,a):(e="ltr"==b.direction?-1!=c.indexOf("l")?d[0]:d[1]:-1!=c.indexOf("l")?d[1]:d[0],b.pages[e]&&b.pages[e].flip("peel",c,a)),this},_addMotionPage:function(){var a=$(this).data().f.opts,b=a.turn;b.data(),o._addMv.call(b,a.page)},_eventStart:function(e,a,c){var b=a.turn.data(),d=b.pageZoom[a.page];if(e.isDefaultPrevented()){o._updateShadow.call(a.turn);return}d&&d!=b.zoom&&(a.turn.trigger("zoomed",[a.page,a.turn.turn("view",a.page),d,b.zoom,]),b.pageZoom[a.page]=b.zoom),"single"==b.display&&c&&("l"==c.charAt(1)&&"ltr"==b.direction||"r"==c.charAt(1)&&"rtl"==b.direction?(a.next=a.next<a.page?a.next:a.page-1,a.force=!0):a.next=a.next>a.page?a.next:a.page+1),o._addMotionPage.call(e.target),o._updateShadow.call(a.turn)},_eventEnd:function(e,a,f){var b=($(e.target).data().f,a.turn),c=b.data();if(f){var d=c.tpage||c.page;(d==a.next||d==a.page)&&(delete c.tpage,o._fitPage.call(b,d||a.next,!0))}else o._removeMv.call(b,a.page),o._updateShadow.call(b),b.turn("update")},_eventPressed:function(d){var a=$(d.target).data().f,b=a.opts.turn,c=b.data();return c.pages,c.mouseAction=!0,b.turn("update"),a.time=new Date().getTime()},_eventReleased:function(d,a){var e,b=$(d.target),c=b.data().f,f=c.opts.turn,g=f.data();e="single"==g.display?"br"==a.corner||"tr"==a.corner?a.x<b.width()/2:a.x>b.width()/2:a.x<0||a.x>b.width(),(new Date().getTime()-c.time<200||e)&&(d.preventDefault(),o._turnPage.call(f,c.opts.next)),g.mouseAction=!1},_flip:function(b){b.stopPropagation();var a=$(b.target).data().f.opts;a.turn.trigger("turn",[a.next]),a.turn.data().opts.autoCenter&&a.turn.turn("center",a.next)},_touchStart:function(){var a=this.data();for(var b in a.pages)if(y(b,a.pages)&& !1===p._eventStart.apply(a.pages[b],arguments))return!1},_touchMove:function(){var a=this.data();for(var b in a.pages)y(b,a.pages)&&p._eventMove.apply(a.pages[b],arguments)},_touchEnd:function(){var a=this.data();for(var b in a.pages)y(b,a.pages)&&p._eventEnd.apply(a.pages[b],arguments)},calculateZ:function(g){var a,b,c,h,e,m=this,d=this.data(),i=this.turn("view"),l=i[0]||i[1],j=g.length-1,f={pageZ:{},partZ:{},pageV:{}},k=function(b){var a=m.turn("view",b);a[0]&&(f.pageV[a[0]]=!0),a[1]&&(f.pageV[a[1]]=!0)};for(a=0;a<=j;a++)b=g[a],c=d.pages[b].data().f.opts.next,h=d.pagePlace[b],k(b),k(c),e=d.pagePlace[c]==c?c:b,f.pageZ[e]=d.totalPages-Math.abs(l-e),f.partZ[h]=2*d.totalPages-j+a;return f},update:function(){var a,b=this.data();if(this.turn("animating")&&0!==b.pageMv[0]){var c,e,d=this.turn("calculateZ",b.pageMv),h=this.turn("corner"),f=this.turn("view"),g=this.turn("view",b.tpage);for(a in b.pageWrap)y(a,b.pageWrap)&&(e=b.pageObjs[a].hasClass("fixed"),b.pageWrap[a].css({display:d.pageV[a]||e?"":"none",zIndex:(b.pageObjs[a].hasClass("hard")?d.partZ[a]:d.pageZ[a])||(e?-1:0)}),(c=b.pages[a])&&(c.flip("z",d.partZ[a]||null),d.pageV[a]&&c.flip("resize"),b.tpage?c.flip("hover",!1).flip("disable",-1==$.inArray(parseInt(a,10),b.pageMv)&&a!=g[0]&&a!=g[1]):c.flip("hover",!1===h).flip("disable",a!=f[0]&&a!=f[1])))}else for(a in b.pageWrap)if(y(a,b.pageWrap)){var i=o._setPageLoc.call(this,a);b.pages[a]&&b.pages[a].flip("disable",b.disabled||1!=i).flip("hover",!0).flip("z",null)}return this},_updateShadow:function(){var b,d,h,a=this.data(),e=this.width(),f=this.height(),g="single"==a.display?e:e/2;b=this.turn("view"),a.shadow||(a.shadow=$("<div />",{class:"shadow",css:r(0,0,0).css}).appendTo(this));for(var c=0;c<a.pageMv.length&&b[0]&&b[1];c++)b=this.turn("view",a.pages[a.pageMv[c]].data().f.opts.next),d=this.turn("view",a.pageMv[c]),b[0]=b[0]&&d[0],b[1]=b[1]&&d[1];switch(b[0]?b[1]?3:"ltr"==a.direction?2:1:"ltr"==a.direction?1:2){case 1:a.shadow.css({width:g,height:f,top:0,left:g});break;case 2:a.shadow.css({width:g,height:f,top:0,left:0});break;case 3:a.shadow.css({width:e,height:f,top:0,left:0})}},_setPageLoc:function(a){var b=this.data(),c=this.turn("view"),d=0;if(a==c[0]||a==c[1]?d=1:("single"==b.display&&a==c[0]+1||"double"==b.display&&a==c[0]-2||a==c[1]+2)&&(d=2),!this.turn("animating"))switch(d){case 1:b.pageWrap[a].css({zIndex:b.totalPages,display:""});break;case 2:b.pageWrap[a].css({zIndex:b.totalPages-1,display:""});break;case 0:b.pageWrap[a].css({zIndex:0,display:b.pageObjs[a].hasClass("fixed")?"":"none"})}return d},options:function(a){if(void 0===a)return this.data().opts;var c=this.data();if($.extend(c.opts,a),a.pages&&this.turn("pages",a.pages),a.page&&this.turn("page",a.page),a.display&&this.turn("display",a.display),a.direction&&this.turn("direction",a.direction),a.width&&a.height&&this.turn("size",a.width,a.height),a.when)for(var b in a.when)y(b,a.when)&&this.unbind(b).bind(b,a.when[b]);return this},version:function(){return"4.1.0"}},p={init:function(a){return this.data({f:{disabled:!1,hover:!1,effect:this.hasClass("hard")?"hard":"sheet"}}),this.flip("options",a),p._addPageWrapper.call(this),this},setData:function(b){var a=this.data();return a.f=$.extend(a.f,b),this},options:function(a){var b=this.data().f;return a?(p.setData.call(this,{opts:$.extend({},b.opts||n,a)}),this):b.opts},z:function(b){var a=this.data().f;return a.opts["z-index"]=b,a.fwrapper&&a.fwrapper.css({zIndex:b||parseInt(a.parent.css("z-index"),10)||0}),this},_cAllowed:function(){var c=this.data().f,d=c.opts.page,a=c.opts.turn.data(),b=d%2;return"hard"==c.effect?"ltr"==a.direction?[b?"r":"l"]:[b?"l":"r"]:"single"!=a.display?"ltr"==a.direction?j[b?"forward":"backward"]:j[b?"backward":"forward"]:1==d?"ltr"==a.direction?j.forward:j.backward:d==a.totalPages?"ltr"==a.direction?j.backward:j.forward:j.all},_cornerActivated:function(d){var e=this.data().f,c=this.width(),f=this.height(),a={x:d.x,y:d.y,corner:""},b=e.opts.cornerSize;if(a.x<=0||a.y<=0||a.x>=c||a.y>=f)return!1;var g=p._cAllowed.call(this);switch(e.effect){case"hard":if(a.x>c-b)a.corner="r";else{if(!(a.x<b))return!1;a.corner="l"}break;case"sheet":if(a.y<b)a.corner+="t";else{if(!(a.y>=f-b))return!1;a.corner+="b"}if(a.x<=b)a.corner+="l";else{if(!(a.x>=c-b))return!1;a.corner+="r"}}return!!a.corner&& -1!=$.inArray(a.corner,g)&&a},_isIArea:function(b){var c=this.data().f.parent.offset();return b=a&&b.originalEvent?b.originalEvent.touches[0]:b,p._cornerActivated.call(this,{x:b.pageX-c.left,y:b.pageY-c.top})},_c:function(b,a){switch(a=a||0,b){case"tl":return u(a,a);case"tr":return u(this.width()-a,a);case"bl":return u(a,this.height()-a);case"br":return u(this.width()-a,this.height()-a);case"l":return u(a,0);case"r":return u(this.width()-a,0)}},_c2:function(a){switch(a){case"tl":case"l":return u(2*this.width(),0);case"tr":case"r":return u(-this.width(),0);case"bl":return u(2*this.width(),this.height());case"br":return u(-this.width(),this.height())}},_foldingPage:function(){var a=this.data().f;if(a){var b=a.opts;if(b.turn)return"single"==(a=b.turn.data()).display?b.next>1||b.page>1?a.pageObjs[0]:null:a.pageObjs[b.next]}},_backGradient:function(){var a=this.data().f,b=a.opts.turn.data(),c=b.opts.gradients&&("single"==b.display||2!=a.opts.page&&a.opts.page!=b.totalPages-1);return c&&!a.bshadow&&(a.bshadow=$("<div/>",r(0,0,1)).css({position:"",width:this.width(),height:this.height()}).appendTo(a.parent)),c},type:function(){return this.data().f.effect},resize:function(g){var a=this.data().f,h=a.opts.turn.data(),b=this.width(),c=this.height();switch(a.effect){case"hard":g&&(a.wrapper.css({width:b,height:c}),a.fpage.css({width:b,height:c}),h.opts.gradients&&(a.ashadow.css({width:b,height:c}),a.bshadow.css({width:b,height:c})));break;case"sheet":if(g){var f=Math.round(Math.sqrt(Math.pow(b,2)+Math.pow(c,2)));a.wrapper.css({width:f,height:f}),a.fwrapper.css({width:f,height:f}).children(":first-child").css({width:b,height:c}),a.fpage.css({width:b,height:c}),h.opts.gradients&&a.ashadow.css({width:b,height:c}),p._backGradient.call(this)&&a.bshadow.css({width:b,height:c})}if(a.parent.is(":visible")){var d=e(a.parent[0]);a.fwrapper.css({top:d.top,left:d.left}),d=e(a.opts.turn[0]),a.fparent.css({top:-d.top,left:-d.left})}this.flip("z",a.opts["z-index"])}},_addPageWrapper:function(){var a=this.data().f,e=a.opts.turn.data(),b=this.parent();if(a.parent=b,!a.wrapper)switch(a.effect){case"hard":var c={};c[h+"transform-style"]="preserve-3d",c[h+"backface-visibility"]="hidden",a.wrapper=$("<div/>",r(0,0,2)).css(c).appendTo(b).prepend(this),a.fpage=$("<div/>",r(0,0,1)).css(c).appendTo(b),e.opts.gradients&&(a.ashadow=$("<div/>",r(0,0,0)).hide().appendTo(b),a.bshadow=$("<div/>",r(0,0,0)));break;case"sheet":if(this.width(),this.height(),a.fparent=a.opts.turn.data().fparent,!a.fparent){var d=$("<div/>",{css:{"pointer-events":"none"}}).hide();d.data().flips=0,d.css(r(0,0,"auto","visible").css).appendTo(a.opts.turn),a.opts.turn.data().fparent=d,a.fparent=d}this.css({position:"absolute",top:0,left:0,bottom:"auto",right:"auto"}),a.wrapper=$("<div/>",r(0,0,this.css("z-index"))).appendTo(b).prepend(this),a.fwrapper=$("<div/>",r(b.offset().top,b.offset().left)).hide().appendTo(a.fparent),a.fpage=$("<div/>",r(0,0,0,"visible")).css({cursor:"default"}).appendTo(a.fwrapper),e.opts.gradients&&(a.ashadow=$("<div/>",r(0,0,1)).appendTo(a.fpage)),p.setData.call(this,a)}p.resize.call(this,!0)},_fold:function(c){var a=this.data().f,y=a.opts.turn.data(),C=p._c.call(this,c.corner),d=this.width(),E=this.height();switch(a.effect){case"hard":"l"==c.corner?c.x=Math.min(Math.max(c.x,0),2*d):c.x=Math.max(Math.min(c.x,d),-d);var k,l,f,A,n,B=y.totalPages,o=a.opts["z-index"]||B,D={overflow:"visible"},j=C.x?(C.x-c.x)/d:c.x/d,m=90*j,q=m<90;switch(c.corner){case"l":A="0% 50%",n="100% 50%",q?(k=0,l=a.opts.next-1>0,f=1):(k="100%",l=a.opts.page+1<B,f=0);break;case"r":A="100% 50%",n="0% 50%",m=-m,d=-d,q?(k=0,l=a.opts.next+1<B,f=0):(k="-100%",l=1!=a.opts.page,f=1)}D[h+"perspective-origin"]=n,a.wrapper.transform("rotateY("+m+"deg)translate3d(0px, 0px, "+(this.attr("depth")||0)+"px)",n),a.fpage.transform("translateX("+d+"px) rotateY("+(180+m)+"deg)",A),a.parent.css(D),q?(j=-j+1,a.wrapper.css({zIndex:o+1}),a.fpage.css({zIndex:o})):(j-=1,a.wrapper.css({zIndex:o}),a.fpage.css({zIndex:o+1})),y.opts.gradients&&(l?a.ashadow.css({display:"",left:k,backgroundColor:"rgba(0,0,0,"+.5*j+")"}).transform("rotateY(0deg)"):a.ashadow.hide(),a.bshadow.css({opacity:-j+1}),q?a.bshadow.parent()[0]!=a.wrapper[0]&&a.bshadow.appendTo(a.wrapper):a.bshadow.parent()[0]!=a.fpage[0]&&a.bshadow.appendTo(a.fpage),z(a.bshadow,u(100*f,0),u((-f+1)*100,0),[[0,"rgba(0,0,0,0.3)"],[1,"rgba(0,0,0,0)"],],2));break;case"sheet":var F,G,H,I,J,K,L,M=this,r=0,N=0,O=u(0,0),P=u(0,0),e=u(0,0),Q=p._foldingPage.call(this),R=y.opts.acceleration,S=a.wrapper.height(),T="t"==c.corner.substr(0,1),U="l"==c.corner.substr(1,1),s=function(){var f=u(0,0),h=u(0,0);f.x=C.x?C.x-c.x:c.x,g?f.y=C.y?C.y-c.y:c.y:f.y=0,h.x=U?d-f.x/2:c.x+f.x/2,h.y=f.y/2;var a=i-Math.atan2(f.y,f.x),w=a-Math.atan2(h.y,h.x),m=Math.max(0,Math.sin(w)*Math.sqrt(Math.pow(h.x,2)+Math.pow(h.y,2)));if(r=t(a),e=u(m*Math.sin(a),m*Math.cos(a)),a>i&&(e.x=e.x+Math.abs(e.y*f.y/f.x),e.y=0,Math.round(e.x*Math.tan(b-a))<E))return c.y=Math.sqrt(Math.pow(E,2)+2*h.x*f.x),T&&(c.y=E-c.y),s();if(a>i){var l=b-a,n=S-E/Math.sin(l);O=u(Math.round(n*Math.cos(l)),Math.round(n*Math.sin(l))),U&&(O.x=-O.x),T&&(O.y=-O.y)}F=Math.round(e.y/Math.tan(a)+e.x);var j=d-F,o=j*Math.cos(2*a),q=j*Math.sin(2*a);if(P=u(Math.round(U?j-o:F+o),Math.round(T?q:E-q)),y.opts.gradients){J=j*Math.sin(a);var v=p._c2.call(M,c.corner),k=Math.sqrt(Math.pow(v.x-c.x,2)+Math.pow(v.y-c.y,2))/d;L=Math.sin(i*(k>1?2-k:k)),K=Math.min(k,1),I=J>100?(J-100)/J:0,G=u(J*Math.sin(a)/d*100,J*Math.cos(a)/E*100),p._backGradient.call(M)&&(H=u(1.2*J*Math.sin(a)/d*100,1.2*J*Math.cos(a)/E*100),U||(H.x=100-H.x),T||(H.y=100-H.y))}return e.x=Math.round(e.x),e.y=Math.round(e.y),!0},v=function(b,f,c,e){var g=["0","auto"],i=(d-S)*c[0]/100,j=(E-S)*c[1]/100,k={left:g[f[0]],top:g[f[1]],right:g[f[2]],bottom:g[f[3]]},l={},m=90!=e&& -90!=e?U?-1:1:0,h=c[0]+"% "+c[1]+"%";M.css(k).transform(x(e)+w(b.x+m,b.y,R),h),a.fpage.css(k).transform(x(e)+w(b.x+P.x-O.x-d*c[0]/100,b.y+P.y-O.y-E*c[1]/100,R)+x((180/e-2)*e),h),a.wrapper.transform(w(-b.x+i-m,-b.y+j,R)+x(-e),h),a.fwrapper.transform(w(-b.x+O.x+i,-b.y+O.y+j,R)+x(-e),h),y.opts.gradients&&(c[0]&&(G.x=100-G.x),c[1]&&(G.y=100-G.y),l["box-shadow"]="0 0 20px rgba(0,0,0,"+.5*L+")",Q.css(l),z(a.ashadow,u(U?100:0,T?0:100),u(G.x,G.y),[[I,"rgba(0,0,0,0)"],[(1-I)*.8+I,"rgba(0,0,0,"+.2*K+")",],[1,"rgba(255,255,255,"+.2*K+")"],],3,N),p._backGradient.call(M)&&z(a.bshadow,u(U?0:100,T?0:100),u(H.x,H.y),[[.6,"rgba(0,0,0,0)"],[.8,"rgba(0,0,0,"+.3*K+")"],[1,"rgba(0,0,0,0)"],],3))};switch(c.corner){case"l":case"r":break;case"tl":c.x=Math.max(c.x,1),s(),v(e,[1,0,0,1],[100,0],r);break;case"tr":c.x=Math.min(c.x,d-1),s(),v(u(-e.x,e.y),[0,0,0,1],[0,0],-r);break;case"bl":c.x=Math.max(c.x,1),s(),v(u(e.x,-e.y),[1,1,0,0],[100,100],-r);break;case"br":c.x=Math.min(c.x,d-1),s(),v(u(-e.x,-e.y),[0,1,1,0],[0,100],r)}}a.point=c},_moveFoldingPage:function(f){var a=this.data().f;if(a){var e=a.opts.turn,b=e.data(),c=b.pagePlace;if(f){var d=a.opts.next;c[d]!=a.opts.page&&(a.folding&&p._moveFoldingPage.call(this,!1),p._foldingPage.call(this).appendTo(a.fpage),c[d]=a.opts.page,a.folding=d),e.turn("update")}else if(a.folding){if(b.pages[a.folding]){var g=b.pages[a.folding].data().f;b.pageObjs[a.folding].appendTo(g.wrapper)}else b.pageWrap[a.folding]&&b.pageObjs[a.folding].appendTo(b.pageWrap[a.folding]);a.folding in c&&(c[a.folding]=a.folding),delete a.folding}}},_showFoldedPage:function(b,f){var g=p._foldingPage.call(this),c=this.data(),a=c.f,d=a.visible;if(g){if(!d||!a.point||a.point.corner!=b.corner){var h="hover"==a.status||"peel"==a.status||a.opts.turn.data().mouseAction?b.corner:null;if(d=!1,"prevented"==A("start",this,[a.opts,h]))return!1}if(f){var i=this,e=a.point&&a.point.corner==b.corner?a.point:p._c.call(this,b.corner,1);this.animatef({from:[e.x,e.y],to:[b.x,b.y],duration:500,frame:function(a){b.x=Math.round(a[0]),b.y=Math.round(a[1]),p._fold.call(i,b)}})}else p._fold.call(this,b),c.effect&&!c.effect.turning&&this.animatef(!1);if(!d)switch(a.effect){case"hard":a.visible=!0,p._moveFoldingPage.call(this,!0),a.fpage.show(),a.opts.shadows&&a.bshadow.show();break;case"sheet":a.visible=!0,a.fparent.show().data().flips++,p._moveFoldingPage.call(this,!0),a.fwrapper.show(),a.bshadow&&a.bshadow.show()}return!0}return!1},hide:function(){var a=this.data().f,b=a.opts.turn.data(),c=p._foldingPage.call(this);switch(a.effect){case"hard":b.opts.gradients&&(a.bshadowLoc=0,a.bshadow.remove(),a.ashadow.hide()),a.wrapper.transform(""),a.fpage.hide();break;case"sheet":0== --a.fparent.data().flips&&a.fparent.hide(),this.css({left:0,top:0,right:"auto",bottom:"auto"}).transform(""),a.wrapper.transform(""),a.fwrapper.hide(),a.bshadow&&a.bshadow.hide(),c.transform("")}return a.visible=!1,this},hideFoldedPage:function(f){var c=this.data().f;if(c.point){var g=this,a=c.point,d=function(){c.point=null,c.status="",g.flip("hide"),g.trigger("end",[c.opts,!1])};if(f){var b=p._c.call(this,a.corner),e="t"==a.corner.substr(0,1)?Math.min(0,a.y-b.y)/2:Math.max(0,a.y-b.y)/2,h=u(a.x,a.y+e),i=u(b.x,b.y-e);this.animatef({from:0,to:1,frame:function(d){var c=s(a,h,i,b,d);a.x=c.x,a.y=c.y,p._fold.call(g,a)},complete:d,duration:800,hiding:!0})}else this.animatef(!1),d()}},turnPage:function(b){var d=this,a=this.data().f,c=a.opts.turn.data();b={corner:a.corner?a.corner.corner:b||p._cAllowed.call(this)[0]};var e=a.point||p._c.call(this,b.corner,a.opts.turn?c.opts.elevation:0),f=p._c2.call(this,b.corner);this.trigger("flip").animatef({from:0,to:1,frame:function(c){var a=s(e,e,f,f,c);b.x=a.x,b.y=a.y,p._showFoldedPage.call(d,b)},complete:function(){d.trigger("end",[a.opts,!0])},duration:c.opts.duration,turning:!0}),a.corner=null},moving:function(){return"effect"in this.data()},isTurning:function(){return this.flip("moving")&&this.data().effect.turning},corner:function(){return this.data().f.corner},_eventStart:function(b){var a=this.data().f,c=a.opts.turn;if(!a.corner&&!a.disabled&&!this.flip("isTurning")&&a.opts.page==c.data().pagePlace[a.opts.page]){if(a.corner=p._isIArea.call(this,b),a.corner&&p._foldingPage.call(this))return this.trigger("pressed",[a.point]),p._showFoldedPage.call(this,a.corner),!1;a.corner=null}},_eventMove:function(c){var b=this.data().f;if(!b.disabled){if(c=a?c.originalEvent.touches:[c],b.corner){var e=b.parent.offset();b.corner.x=c[0].pageX-e.left,b.corner.y=c[0].pageY-e.top,p._showFoldedPage.call(this,b.corner)}else if(b.hover&&!this.data().effect&&this.is(":visible")){var d=p._isIArea.call(this,c[0]);if(d){if("sheet"==b.effect&&2==d.corner.length||"hard"==b.effect){b.status="hover";var f=p._c.call(this,d.corner,b.opts.cornerSize/2);d.x=f.x,d.y=f.y,p._showFoldedPage.call(this,d,!0)}}else"hover"==b.status&&(b.status="",p.hideFoldedPage.call(this,!0))}}},_eventEnd:function(){var a=this.data().f,b=a.corner;!a.disabled&&b&&"prevented"!=A("released",this,[a.point||b])&&p.hideFoldedPage.call(this,!0),a.corner=null},disable:function(a){return p.setData.call(this,{disabled:a}),this},hover:function(a){return p.setData.call(this,{hover:a}),this},peel:function(a,c){var b=this.data().f;if(a){if(-1==$.inArray(a,j.all))throw B("Corner "+a+" is not permitted");if(-1!=$.inArray(a,p._cAllowed.call(this))){var d=p._c.call(this,a,b.opts.cornerSize/2);b.status="peel",p._showFoldedPage.call(this,{corner:a,x:d.x,y:d.y},c)}}else b.status="",p.hideFoldedPage.call(this,c);return this}};function q(c,b,a){if(!a[0]||"object"==typeof a[0])return b.init.apply(c,a);if(b[a[0]])return b[a[0]].apply(c,Array.prototype.slice.call(a,1));throw B(a[0]+" is not a method or property")}function r(a,b,c,d){return{css:{position:"absolute",top:a,left:b,overflow:d||"hidden",zIndex:c||"auto"}}}function s(c,d,e,f,a){var b=1-a,g=b*b*b,h=a*a*a;return u(Math.round(g*c.x+3*a*b*b*d.x+3*a*a*b*e.x+h*f.x),Math.round(g*c.y+3*a*b*b*d.y+3*a*a*b*e.y+h*f.y))}function t(a){return a/b*180}function u(a,b){return{x:a,y:b}}function v(){var a;return!(a=/AppleWebkit\/([0-9\.]+)/i.exec(navigator.userAgent))||parseFloat(a[1])>534.3}function w(a,b,c){return f&&c?" translate3d("+a+"px,"+b+"px, 0px) ":" translate("+a+"px, "+b+"px) "}function x(a){return" rotate("+a+"deg) "}function y(a,b){return Object.prototype.hasOwnProperty.call(b,a)}function d(){for(var a=["Moz","Webkit","Khtml","O","ms"],b=a.length,c="";b--;)a[b]+"Transform" in document.body.style&&(c="-"+a[b].toLowerCase()+"-");return c}function z(b,a,d,e,n){var c,f=[];if("-webkit-"==h){for(c=0;c<n;c++)f.push("color-stop("+e[c][0]+", "+e[c][1]+")");b.css({"background-image":"-webkit-gradient(linear, "+a.x+"% "+a.y+"%,"+d.x+"% "+d.y+"%, "+f.join(",")+" )"})}else{a={x:a.x/100*b.width(),y:a.y/100*b.height()};var j=(d={x:d.x/100*b.width(),y:d.y/100*b.height()}).x-a.x,k=d.y-a.y,l=Math.atan2(k,j),o=l-Math.PI/2,r=Math.abs(b.width()*Math.sin(o))+Math.abs(b.height()*Math.cos(o)),s=Math.sqrt(k*k+j*j),g=u(d.x<a.x?b.width():0,d.y<a.y?b.height():0),m=Math.tan(l),i=-1/m,p=(i*g.x-g.y-m*a.x+a.y)/(i-m),q={x:p,y:i*p-i*g.x+g.y},t=Math.sqrt(Math.pow(q.x-a.x,2)+Math.pow(q.y-a.y,2));for(c=0;c<n;c++)f.push(" "+e[c][1]+" "+(t+s*e[c][0])*100/r+"%");b.css({"background-image":h+"linear-gradient("+ -l+"rad,"+f.join(",")+")"})}}function A(b,c,d){var a=$.Event(b);return(c.trigger(a,d),a.isDefaultPrevented())?"prevented":a.isPropagationStopped()?"stopped":""}function B(b){function a(a){this.name="TurnJsError",this.message=a}return a.prototype=new Error,a.prototype.constructor=a,new a(b)}function e(a){var b={top:0,left:0};do b.left+=a.offsetLeft,b.top+=a.offsetTop;while(a=a.offsetParent)return b}function C(){return -1==navigator.userAgent.indexOf("MSIE 9.0")}window.requestAnim=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)},$.extend($.fn,{flip:function(){return q($(this[0]),p,arguments)},turn:function(){return q($(this[0]),o,arguments)},transform:function(c,b){var a={};return b&&(a[h+"transform-origin"]=b),a[h+"transform"]=c,this.css(a)},animatef:function(a){var b=this.data();if(b.effect&&b.effect.stop(),a){a.to.length||(a.to=[a.to]),a.from.length||(a.from=[a.from]);for(var d=[],e=a.to.length,g=!0,h=this,i=new Date().getTime(),f=function(){if(b.effect&&g){for(var j=[],k=Math.min(a.duration,new Date().getTime()-i),c=0;c<e;c++)j.push(b.effect.easing(1,k,a.from[c],d[c],a.duration));a.frame(1==e?j[0]:j),k==a.duration?(delete b.effect,h.data(b),a.complete&&a.complete()):window.requestAnim(f)}},c=0;c<e;c++)d.push(a.to[c]-a.from[c]);b.effect=$.extend({stop:function(){g=!1},easing:function(e,a,b,c,d){return c*Math.sqrt(1-(a=a/d-1)*a)+b}},a),this.data(b),f()}else delete b.effect}}),$.isTouch=a,$.mouseEvents=c,$.cssPrefix=d,$.cssTransitionEnd=function(){var a,c=document.createElement("fakeelement"),b={transition:"transitionend",OTransition:"oTransitionEnd",MSTransition:"transitionend",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(a in b)if(void 0!==c.style[a])return b[a]},$.findPos=e}(jQuery)